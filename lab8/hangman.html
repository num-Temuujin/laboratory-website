<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hangman - 3 асуулт</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --accent:#7dd3fc; --muted:#9aa8b2;
    --btn:#111827; --btn-text:#e6eef6;
  }
  body{
    margin:0; font-family: "Segoe UI", Roboto, "Noto Sans", sans-serif;
    background: linear-gradient(180deg,#071025 0%, #081726 100%); color:#e6eef6;
    display:flex; align-items:center; justify-content:center; min-height:100vh;
    padding:20px;
  }
  .app{
    width:100%; max-width:980px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px; box-shadow: 0 8px 30px rgba(2,6,23,0.7); padding:20px;
    display:grid; grid-template-columns: 1fr 360px; gap:18px;
  }

  header{ grid-column:1/-1; display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;}
  h1{ font-size:20px; margin:0; color:var(--accent); }
  .small{ color:var(--muted); font-size:13px; }

  .left{ padding:18px; background:rgba(255,255,255,0.02); border-radius:10px; }
  .right{ padding:18px; background:rgba(255,255,255,0.01); border-radius:10px; }

  .question{ font-size:18px; margin-bottom:10px; color:#dff8ff; }
  .word-wrap{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; }
  .letter-box{
    min-width:36px; height:48px; display:flex; align-items:center; justify-content:center;
    border-radius:6px; background:rgba(255,255,255,0.03); font-size:20px; font-weight:700;
    border:1px dashed rgba(255,255,255,0.03);
  }

  .keyboard{ display:flex; flex-wrap:wrap; gap:6px; margin-top:10px; }
  .key{
    min-width:36px; padding:8px 10px; text-align:center; border-radius:6px; cursor:pointer;
    background:var(--btn); color:var(--btn-text); border:1px solid rgba(255,255,255,0.03);
    user-select:none;
  }
  .key.disabled{ opacity:0.35; cursor:not-allowed; transform:none; }
  .key.correct{ background:linear-gradient(90deg,#0ea5a3,#60a5fa); color:#071022; font-weight:700; }
  .key.wrong{ background:linear-gradient(90deg,#f97316,#ef4444); color:#071022; font-weight:700; }

  .controls{ display:flex; gap:10px; margin-top:12px; }
  button.action{
    background:var(--accent); color:#042a35; font-weight:700; border:0; padding:8px 12px; border-radius:8px; cursor:pointer;
  }
  .info{ margin-top:12px; color:var(--muted); font-size:14px; }

  canvas{ background:transparent; width:100%; height:320px; }

  .status{ margin-top:8px; display:flex; gap:8px; align-items:center; justify-content:space-between; }
  .progress{ color:var(--muted); font-size:13px; }
  .result{ font-weight:800; color:#a7f3d0; }

  @media (max-width:880px){
    .app{ grid-template-columns: 1fr; }
    .right{ order:-1; }
  }
</style>
</head>
<body>
<div class="app" role="application" aria-label="Hangman game">
  <header>
    <h1>Hangman — 3 асуулттай</h1>
    <div class="small">Давтагдсан үсэгүүдийг нэг бүрчлэн тайлж харуулна.</div>
  </header>

  <div class="left">
    <div class="question" id="questionText">Асуулт ачаалж байна...</div>
    <div class="word-wrap" id="wordWrap" aria-live="polite"></div>

    <div class="keyboard" id="keyboard"></div>

    <div class="controls">
      <button class="action" id="hintBtn">Бага зэрэг заавар / Hint</button>
      <button class="action" id="nextBtn">Дараах</button>
    </div>

    <div class="info">
      <div class="status">
        <div class="progress" id="progressText">Тоглолт: 0 / 3</div>
        <div class="result" id="resultText"></div>
      </div>
      <div style="margin-top:8px;" id="message"></div>
    </div>
  </div>

  <div class="right">
    <canvas id="hangmanCanvas" width="360" height="320" aria-hidden="true"></canvas>
    <div style="margin-top:12px; color:var(--muted); font-size:13px;">
      Алдаагn хязгаар: <strong id="mistakesLeft">6</strong>
    </div>
  </div>
</div>

<script>
/*
 Hangman with special duplicate-letter behavior:
 - Each click on a letter reveals ONE next unrevealed occurrence (left-to-right).
 - The letter button remains enabled until all occurrences are revealed (or it's not in word at all).
 - Wrong guesses disable the letter and count as mistake.
 - 3 questions total (customizable below).
*/

const QUESTIONS = [
  {q: "Чонын хүүхдийг юу гэдэг вэ?", a: "бэлтрэг"},
  {q: "Монгол улсын нийслэл юу вэ?", a: "улaanбаатар".replace(/u/g,'у') /* keep cyrillic: we'll use direct cyrillic below */},
  {q: "Хүн төрөлхтний анхны хүн хэн бэ?", a: "адам"}
];

// NOTE: To make sure Cyrillic letters are correct, redefine QUESTIONS with proper Mongolian Cyrillic strings:
const questions = [
  {q: "Чонын хүүхдийг юу гэдэг вэ?", a: "бэлтрэг"},
  {q: "Монгол улсын нийслэл юу вэ?", a: "улаанбаатар"},
  {q: "Хүн төрөлхтний анхны хүн хэн бэ?", a: "адам"}
];

let currentIndex = 0;
let maxQuestions = 3;
let mistakes = 0;
const maxMistakes = 6;
let revealed = []; // boolean per letter position
let word = "";
let qtext = "";
let totalCorrect = 0;
let totalToReveal = 0;

const questionText = document.getElementById('questionText');
const wordWrap = document.getElementById('wordWrap');
const keyboard = document.getElementById('keyboard');
const hintBtn = document.getElementById('hintBtn');
const nextBtn = document.getElementById('nextBtn');
const progressText = document.getElementById('progressText');
const message = document.getElementById('message');
const mistakesLeft = document.getElementById('mistakesLeft');
const resultText = document.getElementById('resultText');

const canvas = document.getElementById('hangmanCanvas');
const ctx = canvas.getContext('2d');

function resetCanvas(){ ctx.clearRect(0,0,canvas.width,canvas.height); drawGallows(); }
function drawGallows(){
  ctx.strokeStyle = "#9aa8b2"; ctx.lineWidth = 3;
  // base
  ctx.beginPath(); ctx.moveTo(40,300); ctx.lineTo(320,300); ctx.stroke();
  // pole
  ctx.beginPath(); ctx.moveTo(90,300); ctx.lineTo(90,40); ctx.lineTo(220,40); ctx.lineTo(220,80); ctx.stroke();
}
function drawHangman(step){
  // step from 1..6
  ctx.strokeStyle = "#f97316"; ctx.lineWidth = 3;
  if(step>=1){ // head
    ctx.beginPath(); ctx.arc(220,110,30,0,Math.PI*2); ctx.stroke();
  }
  if(step>=2){
    // body
    ctx.beginPath(); ctx.moveTo(220,140); ctx.lineTo(220,220); ctx.stroke();
  }
  if(step>=3){
    // left arm
    ctx.beginPath(); ctx.moveTo(220,160); ctx.lineTo(185,190); ctx.stroke();
  }
  if(step>=4){
    // right arm
    ctx.beginPath(); ctx.moveTo(220,160); ctx.lineTo(255,190); ctx.stroke();
  }
  if(step>=5){
    // left leg
    ctx.beginPath(); ctx.moveTo(220,220); ctx.lineTo(190,260); ctx.stroke();
  }
  if(step>=6){
    // right leg
    ctx.beginPath(); ctx.moveTo(220,220); ctx.lineTo(250,260); ctx.stroke();
  }
}

function initKeyboard(){
  // Mongolian Cyrillic keyboard letters (common set)
  // Note: some letters like 'ё', 'ъ', 'ь' are rare; keep core alphabet
  const letters = "абвгдеёжзийклмнопрстуфхцчшщъыьэюя";
  keyboard.innerHTML = "";
  for(const ch of letters){
    const btn = document.createElement('button');
    btn.className = 'key';
    btn.textContent = ch;
    btn.dataset.letter = ch;
    btn.addEventListener('click', ()=> onLetterClick(ch, btn));
    keyboard.appendChild(btn);
  }
}

function startQuestion(idx){
  if(idx >= maxQuestions){
    // game finished
    questionText.textContent = "Бүх асуулт дууслаа!";
    wordWrap.innerHTML = "";
    keyboard.querySelectorAll('.key').forEach(k=>k.disabled=true);
    resultText.textContent = "Тоглолт дууссан";
    return;
  }
  mistakes = 0;
  mistakesLeft.textContent = maxMistakes - mistakes;
  resetCanvas();

  currentIndex = idx;
  qtext = questions[idx].q;
  word = questions[idx].a.trim().toLowerCase(); // assume lowercase Mongolian cyrillic
  // prepare revealed flags
  revealed = Array.from(word).map(ch => (ch === ' ' ? true : false));
  totalToReveal = Array.from(word).filter(ch=>ch!==' ').length;
  totalCorrect = 0;

  renderQuestion();
  updateProgress();
  message.textContent = "";
  resultText.textContent = "";
  // ensure keyboard enabled appropriately
  keyboard.querySelectorAll('.key').forEach(k=>{
    k.classList.remove('disabled','correct','wrong');
    k.disabled = false;
  });
}

function renderQuestion(){
  questionText.textContent = qtext;
  wordWrap.innerHTML = "";
  const letters = Array.from(word);
  letters.forEach((ch,i)=>{
    const box = document.createElement('div');
    box.className = 'letter-box';
    if(ch === ' '){ box.textContent = ''; box.style.visibility='hidden'; }
    else if(revealed[i]) box.textContent = ch;
    else box.textContent = '';
    wordWrap.appendChild(box);
  });
}

function updateProgress(){
  progressText.textContent = `Тоглолт: ${currentIndex+1} / ${maxQuestions}`;
  mistakesLeft.textContent = (maxMistakes - mistakes);
}

function onLetterClick(letter, btn){
  // find next unrevealed occurrence left-to-right
  const indices = [];
  for(let i=0;i<word.length;i++){
    if(word[i] === letter && !revealed[i]) indices.push(i);
  }
  if(indices.length > 0){
    // reveal only the first occurrence (leftmost)
    const idx = indices[0];
    revealed[idx] = true;
    totalCorrect++;
    renderQuestion();
    // Mark button as correct style (but keep enabled until all occurrences revealed)
    btn.classList.add('correct');
    // If this was the last occurrence of that letter, disable the button
    const stillLeft = Array.from(word).some((ch,i)=> ch===letter && !revealed[i]);
    if(!stillLeft){
      btn.disabled = true;
      btn.classList.add('disabled');
    }
    // Check win
    if(totalCorrect >= totalToReveal){
      resultText.style.color = '#a7f3d0';
      resultText.textContent = "Зөв! Та яллаа.";
      // disable keyboard
      keyboard.querySelectorAll('.key').forEach(k=>k.disabled=true);
    }
  } else {
    // no unrevealed occurrence found
    // If the letter exists but all already revealed -> ignore (or show small message)
    const exists = word.includes(letter);
    if(exists){
      // all occurrences already revealed: do nothing (or small notice)
      message.textContent = `Үсэг "${letter}" аль хэдийнэ ил болжээ.`;
      setTimeout(()=>{ message.textContent = ""; },1400);
      // optionally disable button
      btn.disabled = true;
      btn.classList.add('disabled');
      return;
    }
    // letter not in word -> wrong guess (only first time)
    if(!btn.classList.contains('wrong')){
      mistakes++;
      btn.classList.add('wrong');
      btn.disabled = true;
      drawHangman(mistakes);
      mistakesLeft.textContent = (maxMistakes - mistakes);
      if(mistakes >= maxMistakes){
        // lose: reveal word fully
        for(let i=0;i<word.length;i++) revealed[i] = true;
        renderQuestion();
        resultText.style.color = '#ffb4b4';
        resultText.textContent = `Алдаж унасан! Буруу: ${mistakes}/${maxMistakes}`;
        keyboard.querySelectorAll('.key').forEach(k=>k.disabled=true);
      }
    }
  }
}

hintBtn.addEventListener('click', ()=>{
  // simple hint: reveal one unrevealed letter randomly (but follow our "one occurrence" rule)
  const unrevealedIndices = [];
  for(let i=0;i<word.length;i++) if(!revealed[i]) unrevealedIndices.push(i);
  if(unrevealedIndices.length===0) return;
  const idx = unrevealedIndices[Math.floor(Math.random()*unrevealedIndices.length)];
  const letter = word[idx];
  // Reveal only that single occurrence (matching behavior)
  revealed[idx] = true;
  totalCorrect++;
  renderQuestion();
  // find the key button for that letter and mark or disable appropriately
  const btn = Array.from(keyboard.children).find(b=>b.dataset.letter===letter);
  if(btn){
    // If there are more occurrences still, keep enabled; else disable
    const stillLeft = Array.from(word).some((ch,i)=> ch===letter && !revealed[i]);
    if(!stillLeft){ btn.disabled = true; btn.classList.add('disabled'); }
    btn.classList.add('correct');
  }
  // small penalty: count as one mistake (optional). Here we won't apply penalty.
  if(totalCorrect >= totalToReveal){
    resultText.style.color = '#a7f3d0';
    resultText.textContent = "Зөв! Та яллаа.";
    keyboard.querySelectorAll('.key').forEach(k=>k.disabled=true);
  }
});

nextBtn.addEventListener('click', ()=>{
  // proceed to next question
  startQuestion(currentIndex+1);
});

initKeyboard();
resetCanvas();
startQuestion(0);

// prevent text selection double-click quirks on keys
document.addEventListener('selectstart', e=> {
  if(e.target.classList && e.target.classList.contains('key')) e.preventDefault();
});
</script>
</body>
</html>
